@model IEnumerable<ticomarkenet.Models.Imagen>

@{
    ViewData["Title"] = "Index";
    var imagenesJson = System.Text.Json.JsonSerializer.Serialize(Model);
}

<h1>Imágenes</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Subir nueva imagen</a>
</p>

<div id="imagenes-react-root"></div>

<!-- React y ReactDOM desde CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

<script>
    // Datos pasados desde Razor a JS
    const imagenesData = @Html.Raw(imagenesJson);

    const e = React.createElement;

    function ImagenesLista({ imagenes }) {
      return e('table', { className: 'table table-bordered' },
        e('thead', { className: 'table-light' },
          e('tr', null,
            e('th', null, 'Vista previa'),
            e('th', null, 'Producto'),
            e('th', null, 'Acciones'),
          )
        ),
        e('tbody', null,
          imagenes.map(item =>
            e('tr', { key: item.ImagenId },
              e('td', null,
                e('img', {
                  src: `/imagenes/${item.Ruta}`,
                  alt: 'Imagen',
                  width: 150,
                  height: 100,
                  className: 'img-thumbnail'
                })
              ),
              e('td', null, `${item.Producto.Nombre} (${item.Producto.ProductoId})`),
              e('td', null,
                e('a', { href: `/Imagenes/Edit/${item.ImagenId}`, className: 'btn btn-sm btn-warning me-1' }, 'Editar'),
                e('a', { href: `/Imagenes/Details/${item.ImagenId}`, className: 'btn btn-sm btn-info me-1' }, 'Detalles'),
                e('a', { href: `/Imagenes/Delete/${item.ImagenId}`, className: 'btn btn-sm btn-danger' }, 'Eliminar'),
              )
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('imagenes-react-root'));
    root.render(e(ImagenesLista, { imagenes: imagenesData }));
</script>
