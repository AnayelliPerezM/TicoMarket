@model IEnumerable<ticomarkenet.Models.Usuario>

@{
    ViewData["Title"] = "Gestión de Usuarios";
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <!-- React y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 text-primary"><i class="fas fa-users me-2"></i> Gestión de Usuarios</h1>
            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#nuevoUsuarioModal">
                <i class="fas fa-user-plus me-2"></i>Agregar Usuario
            </button>
        </div>

        <!-- React Table Container -->
        <div id="usuarios-react"></div>
    </div>

    <!-- JSON para React -->
    <script>
        const usuarios = @Html.Raw(Json.Serialize(Model));
    </script>

    <!-- React embebido -->
    <script type="text/babel">
        function TablaUsuarios({ data }) {
            const [filtro, setFiltro] = React.useState("");

            const usuariosFiltrados = data.filter(u =>
                (u.nombre + u.email + u.telefono + u.rol + u.direccion)
                    .toLowerCase()
                    .includes(filtro.toLowerCase())
            );

            return (
                <div className="card shadow-sm">
                    <div className="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                        <h5 className="mb-0">Lista de Usuarios</h5>
                        <div className="input-group w-25">
                            <input className="form-control form-control-sm"
                                   placeholder="Buscar..."
                                   onChange={e => setFiltro(e.target.value)} />
                            <button className="btn btn-outline-light btn-sm">
                                <i className="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div className="card-body">
                        <div className="table-responsive shadow rounded-3 bg-white">
                            <table className="table table-hover table-striped mb-0">
                                <thead className="table-primary">
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Correo</th>
                                        <th>Teléfono</th>
                                        <th>Rol</th>
                                        <th>Dirección</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {usuariosFiltrados.map(usuario => (
                                        <tr key={usuario.id_usuario}>
                                            <td>{usuario.id_usuario}</td>
                                            <td>{usuario.nombre}</td>
                                            <td>{usuario.email}</td>
                                            <td>{usuario.telefono}</td>
                                            <td>{usuario.rol}</td>
                                            <td>{usuario.direccion}</td>
                                            <td>
                                                <a className="btn btn-sm btn-outline-info" href="/productos" title="Ver detalles">
                                                    <i className="fas fa-eye"></i>
                                                </a>
                                                <button type="button" className="btn btn-sm btn-outline-warning me-1"
                                                    data-bs-toggle="modal" data-bs-target="#nuevoUsuarioModal">
                                                    <i className="fas fa-edit"></i>
                                                </button>
                                                <a className="btn btn-sm btn-outline-danger"
                                                    href={`/usuarios/eliminar/${usuario.id_usuario}`}>
                                                    <i className="fas fa-trash-alt"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="card-footer bg-light">
                        <small className="text-muted">Total usuarios: {usuariosFiltrados.length}</small>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("usuarios-react"));
        root.render(<TablaUsuarios data={usuarios} />);
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
